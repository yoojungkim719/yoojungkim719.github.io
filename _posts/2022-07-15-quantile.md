---
layout: single
title: "분위수를 구하는 9가지 방법에 대한 비교"
categories: ['statistics']
tag: [statistics, quantile]
use_math: true
toc: true
---

## 1. 분위수의 정의  
  
분위수는 모집단이나 표본의 전체 돗수를 크기 순으로 p등분시키는 (p-1)개의 등분값을 말한다. 만약에 우리가 어떤 확률 분포의 CDF(Cumulative Distribution Function)를 알면 분위수를 쉽게 구할 수 있다. CDF의 역함수가 분위수이기 때문이다. 아래의 그림을 보면 직관적으로 이해할 수 있다. 확률 분포를 전구간 적분하면 1이므로 CDF의 범위는 0부터 1을 가지고, CDF의 역함수를 취하면 해당 y값에 해당하는 x값이 분위수이기 때문이다.  

![](/assets/images/postphotos/2022-07-17-quantile/quantile_cdf.png)

<!--
<center><img src="../assets/images/postphotos/2022-07-17-quantile/quantile_cdf.png" width="70%" height="70%"></center> 
-->

하지만 어떤 확률분포의 CDF를 모르면 어떻게 할까? 이럴 때 우리는 순서통계량을 이용할 수 있다. 어떤 확률분포 $\{X_1, X_2, ..., X_n\}$ 의 순서통계량을 $\{X_{(1)}, X_{(2)}, ..., X_{(n)}\}$라고 하면, 우리는 분위수를 아래와 같이 표현할 수 있다. 여기서 **n=표본수**, **p=구하고자 하는 분위수**, **m=임의의 상수**이다. 향후 우리는 설명의 편의성을 위해 아래 $\gamma$에서 정수 부분을 $j$, 소수 부분을 $g$라고 한다. (하지만 $\gamma$의 정의가 $np+m$에서 $np+m$의 정수 부분을 뺀 것이므로 $\gamma=g$라고 생각해도 무방함)

$$\gamma = (np+m) - \left \lfloor np+m \right \rfloor (0 \leq \gamma \leq 1)$$ 

위에서 정의한 $\gamma$를 이용해 분위수 함수를 아래와 같이 나타낸다.

$$Q(p) = (1-\gamma) X_{(j)} + \gamma X_{(j+1)} \qquad (\frac{j-m}{n} \leq p \leq \frac{j-m+1}{n})$$  

즉 정리하자면, $p$분위수는 $\gamma$값으로 조정된 순서통계량 $X_{(j)}$와 $X_{(j+1)}$ 사이의 값을 의미하는 것이다. 이제 다음 장에서는 위에서 정의한 $\gamma$와 분위수 함수를 이용하여 분위수를 구하는 9가지 방법에 대해 알아보자.

## 2. 분위수를 구하는 9가지 방법
자 이제 위의 순서통계량과 분위수 함수를 활용해 분위수를 구하는 9가지 방법에 대해 알아보자.

#### 1) Type1
가장 오래되고 학술적인 정의인 type1 방법은 $\gamma$에서 $m=0$으로 하고 $np$가 정수인 경우($g=0$)와 정수가 아닌 경우($g=0$)로 구분한다. 이 때 $\gamma$는 아래와 같이 정의된다.

$$\gamma=
\begin{cases}
1\quad(g>0)\\
0\quad(g=0)
\end{cases}$$

위 식을 분위수 함수에 적용하면, 분위수 함수는 아래와 같이 표현할 수 있다.

$$Q(p)=
\begin{cases}
X_{(j+1)}\quad(g>0)\\
X_{(j)}\quad(g=0)
\end{cases} \quad \frac{j}{n}\leq p < \frac{j+1}{n}$$

만일 $p=0$인 경우에는 순서통계량 $X_{(1)}$을, $p=1$인 경우에는 순서통계량 $X_{(n)}$을 반환한다. 이를 R코드 구현하면 아래와 같다.

```r
# data = 분포
# p = 구하고자 하는 분위수
type1 <- function(data, p) {
  data <- sort(data)
  n = length(data)
  if (p==0) {
    Qs<-data[1]
  } else if (p==1) {
    Qs<-data[n]
  } else {
    m = 0
    j = floor(n*p+m) # 정수부분
    g = (n*p+m) - j # 소수부분
    Qs = ifelse(g>0, data[j+1], data[j])
  }
  return(Qs)
}
```

#### 2) Type2
두 번째 type2 방법은 type1 방법과 유사하다. 다만, type2에서는 $np$가 정수인 경우(즉 $g=0$인 경우), $\gamma$가 $0$이 아닌 $\frac{1}{2}$이 된다

$$\gamma=
\begin{cases}
1\quad(g>0)\\
\frac{1}{2}\quad(g=0)
\end{cases}$$

위 식을 분위수 함수에 적용하면, 분위수 함수는 아래와 같이 표현할 수 있다.

$$Q(p)=
\begin{cases}
X_{(j+1)}\quad(g>0)\\
\frac{X_{(j)}+X_{(j+1)}}{2}\quad(g=0)
\end{cases} \quad \frac{j}{n}\leq p < \frac{j+1}{n}$$

즉 type2 방법에서 분위수는 $np$가 정수일 때, 순서통계량 $X_{(j)}$과 $X_{(j+1)}$의 평균값임을 알 수 있다. 만일 $p=0$인 경우에는 순서통계량 $X_{(1)}$을, $p=1$인 경우에는 순서통계량 $X_{(n)}$을 반환한다. 이를 R코드 구현하면 아래와 같다.

```r
# data = 분포
# p = 구하고자 하는 분위수
type2 <- function(data, p) {
  data <- sort(data)
  n = length(data)
  if (p==0) {
    Qs<-data[1]
  } else if (p==1) {
    Qs<-data[n]
  } else {
    m = 0 
    j = floor(n*p+m) #정수부분
    g = (n*p+m) - j #소수부분
    Qs = ifelse(g>0, data[j+1],(data[j] + data[j+1])/2)
  }
  return(Qs)
}
```

현재 추가 중













<!--
---
**[후기]**  
  
1학기 시뮬레이션 수업 때 했던 논문 리뷰를 다시 정리해서 올린다. 이전까지는 '분위수가 그냥 분위수지....'라는 단순한 생각을 가지고 있었는데, 이 논문을 리뷰하면서 분위수를 구하는 방법이 무려 9가지나 존재했다는 걸 알게 되었다. R에서 quantile 함수를 쓸 때 type 옵션이 있는 줄도 모르고 무턱대고 썼는데 역시 세상은 넓고 내가 모르는 것 투성이다.  
  
---
**[Reference]**  
  
허윤숙. (2017). 지수 분포를 따르는 자료의 분위수 계산 방법 비교. 동국대학교 석사학위논문  
Langford, E. (2006). Quartiles in Elementary Statistics, URL: http://www.amstat.org/publications/jse/v14n3/ langford.html.  
Hyndman, R. J., and Fan, Y. (1996). Sample quantiles in statistical packages, American Statistician, Vol.50 No.4 pp.361-365
-->